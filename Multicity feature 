<!-- MULTI-CITY SEARCH FORM - Add this to your index.html -->

<script>
// Multi-City Functionality
let flightCount = 2; // Start with 2 flights

// Tab switching with Multi-City support
document.querySelectorAll('.tab-btn').forEach(tab => {
    tab.addEventListener('click', function() {
        // Update active tab styling
        document.querySelectorAll('.tab-btn').forEach(t => {
            t.style.color = '#8a99b3';
            t.style.borderBottom = '3px solid transparent';
        });
        this.style.color = '#c5ff68';
        this.style.borderBottom = '3px solid #c5ff68';
        
        const tabType = this.dataset.tab;
        const formContainer = document.getElementById('search-form');
        
        if (tabType === 'multicity') {
            showMultiCityForm();
        } else if (tabType === 'roundtrip') {
            showRoundTripForm();
        } else if (tabType === 'oneway') {
            showOneWayForm();
        }
    });
});

function showMultiCityForm() {
    const formContainer = document.getElementById('search-form');
    flightCount = 2;
    
    formContainer.innerHTML = `
        <!-- Travelers & Cabin (Top) -->
        <div style="margin-bottom: 1.5rem;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div>
                    <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Travelers</label>
                    <select id="multi-passengers" style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;">
                        <option>1 traveler</option>
                        <option selected>2 travelers</option>
                        <option>3 travelers</option>
                        <option>4+ travelers</option>
                    </select>
                </div>
                
                <div>
                    <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Cabin class</label>
                    <select id="multi-cabin" style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;">
                        <option>Economy</option>
                        <option>Premium Economy</option>
                        <option selected>Business</option>
                        <option>First Class</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Flights Container -->
        <div id="flights-container">
            ${createFlightRow(1)}
            ${createFlightRow(2)}
        </div>

        <!-- Add Another Flight Button -->
        <button type="button" onclick="addFlight()" style="display: flex; align-items: center; gap: 0.5rem; background: transparent; border: 1px dashed #2a3644; color: #4a9cff; padding: 1rem; border-radius: 12px; width: 100%; justify-content: center; cursor: pointer; font-weight: 600; font-size: 1rem; margin-bottom: 1.5rem; font-family: inherit; transition: all 0.3s;">
            + Add another flight
        </button>

        <!-- Search Button -->
        <button type="submit" style="width: 100%; padding: 1.5rem; background: linear-gradient(135deg, #c5ff68, #a8e050); color: #0a0f1e; border: none; border-radius: 15px; font-size: 1.3rem; font-weight: 800; cursor: pointer; font-family: inherit;">
            üîç Search Flights
        </button>
    `;
    
    // Re-initialize autocomplete for all inputs
    setTimeout(() => initializeMultiCityAutocomplete(), 100);
}

function createFlightRow(num) {
    return `
        <div id="flight-${num}" style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #2a3644;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="color: #c5ff68; font-size: 1rem; margin: 0;">Flight ${num}</h4>
                ${num > 2 ? `<button type="button" onclick="removeFlight(${num})" style="background: transparent; border: 1px solid #e74c3c; color: #e74c3c; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.9rem; font-family: inherit;">Remove</button>` : ''}
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr auto 1fr 1fr; gap: 1rem; align-items: end;">
                <div style="position: relative;">
                    <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Leaving from</label>
                    <input 
                        type="text" 
                        id="multi-from-${num}" 
                        placeholder="BOS - Boston" 
                        class="input-airport multi-city-input" 
                        style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;" 
                        autocomplete="off"
                    >
                </div>

                <button type="button" onclick="swapMultiCity(${num})" style="width: 40px; height: 40px; background: #2a3644; border: none; border-radius: 50%; color: #c5ff68; font-size: 1.1rem; cursor: pointer; margin-bottom: 0.25rem;">
                    ‚áÑ
                </button>

                <div style="position: relative;">
                    <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Going to</label>
                    <input 
                        type="text" 
                        id="multi-to-${num}" 
                        placeholder="JFK - New York" 
                        class="input-airport multi-city-input" 
                        style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;" 
                        autocomplete="off"
                    >
                </div>

                <div>
                    <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Date</label>
                    <input 
                        type="date" 
                        id="multi-date-${num}" 
                        style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;"
                    >
                </div>
            </div>
        </div>
    `;
}

function addFlight() {
    flightCount++;
    if (flightCount > 6) {
        alert('Maximum 6 flights allowed');
        flightCount = 6;
        return;
    }
    
    const container = document.getElementById('flights-container');
    container.insertAdjacentHTML('beforeend', createFlightRow(flightCount));
    
    // Re-initialize autocomplete for new inputs
    initializeMultiCityAutocomplete();
}

function removeFlight(num) {
    const flight = document.getElementById(`flight-${num}`);
    if (flight) {
        flight.remove();
        flightCount--;
    }
}

function swapMultiCity(num) {
    const from = document.getElementById(`multi-from-${num}`);
    const to = document.getElementById(`multi-to-${num}`);
    const temp = from.value;
    from.value = to.value;
    to.value = temp;
}

function initializeMultiCityAutocomplete() {
    document.querySelectorAll('.multi-city-input').forEach(input => {
        // Remove old dropdown if exists
        const oldDropdown = input.parentElement.querySelector('[id$="-dropdown"]');
        if (oldDropdown) oldDropdown.remove();
        
        // Create new dropdown
        const dropdown = document.createElement('div');
        dropdown.id = input.id + '-dropdown';
        dropdown.style.cssText = 'position:absolute; top:calc(100% + 0.5rem); left:0; right:0; background:#1e2836; border:2px solid #c5ff68; border-radius:12px; max-height:280px; overflow-y:auto; z-index:9999; display:none; box-shadow:0 10px 40px rgba(0,0,0,0.7)';
        
        input.parentElement.style.position = 'relative';
        input.parentElement.appendChild(dropdown);
        
        input.addEventListener('input', function() {
            const q = this.value.toLowerCase();
            if (q.length < 1) { dropdown.style.display = 'none'; return; }
            
            const matches = airportsData.filter(a => 
                a.iata.toLowerCase().includes(q) ||
                a.city.toLowerCase().includes(q)
            ).slice(0, 6);
            
            if (matches.length === 0) { dropdown.style.display = 'none'; return; }
            
            dropdown.innerHTML = matches.map(a => 
                `<div onclick="document.getElementById('${input.id}').value='${a.iata} - ${a.city}'; this.parentElement.style.display='none'" 
                      style="padding:0.875rem 1rem; cursor:pointer; border-bottom:1px solid #2a3644; font-size:0.95rem"
                      onmouseover="this.style.background='#0a0f1e'"
                      onmouseout="this.style.background='transparent'">
                    <div style="font-weight:700; color:#c5ff68">${a.iata} - ${a.city}</div>
                    <div style="font-size:0.8rem; color:#8a99b3">${a.name}</div>
                </div>`
            ).join('');
            
            dropdown.style.display = 'block';
        });
        
        input.addEventListener('blur', () => setTimeout(() => dropdown.style.display = 'none', 200));
    });
}

function showRoundTripForm() {
    const formContainer = document.getElementById('search-form');
    formContainer.innerHTML = `
        <!-- From/To -->
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; margin-bottom: 1.5rem; align-items: end;">
            <div style="position: relative;">
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Leaving from</label>
                <input type="text" id="input-from" placeholder="JFK - New York" class="input-airport" style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;" autocomplete="off">
            </div>
            <button type="button" onclick="swapAirports()" style="width: 48px; height: 48px; background: #2a3644; border: none; border-radius: 50%; color: #c5ff68; font-size: 1.3rem; cursor: pointer;">‚áÑ</button>
            <div style="position: relative;">
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Going to</label>
                <input type="text" id="input-to" placeholder="MXP - Milan" class="input-airport" style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;" autocomplete="off">
            </div>
        </div>
        
        <!-- Dates/Passengers/Class -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem;">
            <div><label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Dates</label><input type="text" placeholder="Mon, Jan 20 - Thu, Jan 30" readonly style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit; cursor: pointer;"></div>
            <div><label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Travelers</label><select style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;"><option>1 traveler</option><option selected>2 travelers</option><option>3 travelers</option></select></div>
            <div><label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Cabin class</label><select style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;"><option>Economy</option><option selected>Business</option><option>First Class</option></select></div>
        </div>
        
        <button type="submit" style="width: 100%; padding: 1.5rem; background: linear-gradient(135deg, #c5ff68, #a8e050); color: #0a0f1e; border: none; border-radius: 15px; font-size: 1.3rem; font-weight: 800; cursor: pointer; font-family: inherit;">üîç Search Flights</button>
    `;
    
    setTimeout(() => {
        ['input-from', 'input-to'].forEach(id => {
            const inp = document.getElementById(id);
            if (inp) setupAutocomplete(inp, id);
        });
    }, 50);
}

function showOneWayForm() {
    showRoundTripForm(); // Same form, just hide return date logic
}

// Initialize autocomplete for multi-city inputs
function setupAutocomplete(input, inputId) {
    const dropdown = document.createElement('div');
    dropdown.style.cssText = 'position:absolute; top:calc(100% + 0.5rem); left:0; right:0; background:#1e2836; border:2px solid #c5ff68; border-radius:12px; max-height:280px; overflow-y:auto; z-index:9999; display:none; box-shadow:0 10px 40px rgba(0,0,0,0.7)';
    
    input.parentElement.style.position = 'relative';
    input.parentElement.appendChild(dropdown);
    
    input.addEventListener('input', function() {
        const q = this.value.toLowerCase();
        if (q.length < 1) { dropdown.style.display = 'none'; return; }
        
        const matches = airportsData.filter(a => 
            a.iata.toLowerCase().includes(q) ||
            a.city.toLowerCase().includes(q)
        ).slice(0, 6);
        
        if (matches.length === 0) { dropdown.style.display = 'none'; return; }
        
        dropdown.innerHTML = matches.map(a => 
            `<div onclick="document.getElementById('${inputId}').value='${a.iata} - ${a.city}'; this.parentElement.style.display='none'" 
                  style="padding:1rem; cursor:pointer; border-bottom:1px solid #2a3644"
                  onmouseover="this.style.background='#0a0f1e'"
                  onmouseout="this.style.background='transparent'">
                <div style="font-weight:700; color:#c5ff68">${a.iata} - ${a.city}</div>
                <div style="font-size:0.85rem; color:#8a99b3">${a.name}</div>
            </div>`
        ).join('');
        
        dropdown.style.display = 'block';
    });
    
    input.addEventListener('blur', () => setTimeout(() => dropdown.style.display = 'none', 200));
}
</script>

<!-- ADD TO CSS (in enhancements.css or <style> tag) -->
<style>
.multi-city-input:focus {
    border-color: #c5ff68 !important;
    box-shadow: 0 0 0 3px rgba(197, 255, 104, 0.1);
}

button[onclick="addFlight()"]:hover {
    background: rgba(74, 156, 255, 0.1) !important;
    border-color: #4a9cff !important;
    transform: translateY(-2px);
}
</style>
