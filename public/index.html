<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Award Flights - Book Flights for 50-90% Fewer Points</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css">
  <link rel="stylesheet" href="./enhancements.css">

  <style>
    /* Small mobile safety layer */
    @media (max-width: 900px) {
      .container-header { padding: 0.75rem 1rem !important; }
      .nav { gap: 0.75rem !important; overflow-x: auto; white-space: nowrap; }
      .header-actions { display: none; }
    }
    @media (max-width: 720px) {
      h1 { font-size: 2.6rem !important; }
    }

    .form-error {
      display: none;
      margin: 0 0 1rem 0;
      padding: 0.9rem 1rem;
      border-radius: 12px;
      border: 1px solid rgba(231, 76, 60, 0.35);
      background: rgba(231, 76, 60, 0.12);
      color: #ffd7d2;
      font-weight: 600;
    }
    .field-error {
      border-color: #e74c3c !important;
      box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.15);
    }

    /* Make dropdown usable on mobile */
    .airport-dd {
      max-height: 280px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    /* Disable Search Flights nav link (force home search first) */
    .nav-disabled {
      opacity: 0.55;
      cursor: not-allowed;
      position: relative;
    }
    .nav-disabled:hover::after {
      content: "Search from Home first";
      position: absolute;
      left: 0;
      top: 120%;
      background: rgba(10,15,30,0.95);
      border: 1px solid #2a3644;
      color: #fff;
      padding: 0.5rem 0.7rem;
      border-radius: 10px;
      font-size: 0.85rem;
      white-space: nowrap;
      z-index: 99999;
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="container-header">
      <a href="index.html" class="logo">
        <div class="logo-icon"></div>
        <span>Award Flights</span>
      </a>

      <nav class="nav" aria-label="Primary navigation">
        <a href="index.html" class="active">Home</a>

        <!-- Disabled: you must search from home first -->
        <a href="search.html" id="nav-search" class="nav-disabled" aria-disabled="true">Search Flights</a>

        <a href="live-tracker.html">Live Tracker</a>
        <a href="calculator.html">Points Calculator</a>
        <a href="deals.html">Hot Deals</a>
      </nav>

      <div class="header-actions">
        <button class="btn-secondary">Sign In</button>
        <button class="btn-primary">Sign Up</button>
      </div>
    </div>
  </header>

  <main>
    <section style="min-height: 100vh; padding: 140px 2rem 4rem; background: linear-gradient(135deg, #0a0f1e 0%, #1a2332 100%);">
      <div style="max-width: 1200px; margin: 0 auto;">

        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(197, 255, 104, 0.15); border: 1px solid rgba(197, 255, 104, 0.3); padding: 0.75rem 1.5rem; border-radius: 50px;">
            <span style="color: #c5ff68; font-weight: 600;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
            <span style="color: #8a99b3;">Trusted by 50,000+ travelers worldwide</span>
          </div>
        </div>

        <h1 style="font-size: 4.5rem; font-weight: 900; line-height: 1.1; margin-bottom: 1.5rem; text-align: center;">
          Book Award Flights for
          <span style="display: block; background: linear-gradient(135deg, #c5ff68, #4a9cff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            50-90% Fewer Points
          </span>
        </h1>

        <p style="font-size: 1.3rem; color: #8a99b3; max-width: 700px; margin: 0 auto 3rem; line-height: 1.7; text-align: center;">
          Search 100+ airlines in seconds. Find business class flights for economy points.
        </p>

        <!-- SEARCH WIDGET -->
        <div id="home-search"
          style="background: #1e2836; border-radius: 25px; padding: 2.5rem; border: 1px solid #2a3644; box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5); max-width: 900px; margin: 0 auto 3rem;">
          
          <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #2a3644; padding-bottom: 1rem;">
            <button class="tab-btn" data-tab="roundtrip" onclick="switchTab('roundtrip')"
              style="background: none; border: none; color: #c5ff68; font-weight: 700; font-size: 1.1rem; padding: 0.5rem 1rem; cursor: pointer; border-bottom: 3px solid #c5ff68; font-family: inherit;">
              Round Trip
            </button>
            <button class="tab-btn" data-tab="oneway" onclick="switchTab('oneway')"
              style="background: none; border: none; color: #8a99b3; font-weight: 600; font-size: 1.1rem; padding: 0.5rem 1rem; cursor: pointer; border-bottom: 3px solid transparent; font-family: inherit;">
              One Way
            </button>
            <button class="tab-btn" data-tab="multicity" onclick="switchTab('multicity')"
              style="background: none; border: none; color: #8a99b3; font-weight: 600; font-size: 1.1rem; padding: 0.5rem 1rem; cursor: pointer; border-bottom: 3px solid transparent; font-family: inherit;">
              Multi-City
            </button>
          </div>

          <div id="form-error" class="form-error" role="alert"></div>

          <form id="search-form" novalidate>
            <!-- From/To -->
            <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; margin-bottom: 1.5rem; align-items: end;">
              <div style="position: relative;">
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Leaving from</label>
                <input type="text" id="input-from" placeholder="JFK - New York" class="input-airport"
                  style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;"
                  autocomplete="off" inputmode="search" />
              </div>

              <button type="button" onclick="swapAirports()"
                style="width: 48px; height: 48px; background: #2a3644; border: none; border-radius: 50%; color: #c5ff68; font-size: 1.3rem; cursor: pointer; transition: all 0.3s;">‚áÑ</button>

              <div style="position: relative;">
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Going to</label>
                <input type="text" id="input-to" placeholder="MXP - Milan" class="input-airport"
                  style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;"
                  autocomplete="off" inputmode="search" />
              </div>
            </div>

            <!-- Dates/Passengers/Class -->
            <div id="fields-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
              <div>
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Departure</label>
                <input type="date" id="departure-date" required
                  style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit; color-scheme: dark;">
              </div>

              <div id="return-field">
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Return</label>
                <input type="date" id="return-date" required
                  style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit; color-scheme: dark;">
              </div>

              <div>
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Travelers</label>
                <select id="passengers"
                  style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;">
                  <option selected>1 traveler</option>
                  <option>2 travelers</option>
                  <option>3 travelers</option>
                  <option>4 travelers</option>
                </select>
              </div>

              <div>
                <label style="display: block; font-size: 0.9rem; color: #8a99b3; margin-bottom: 0.5rem; font-weight: 600;">Cabin class</label>
                <select id="cabin"
                  style="width: 100%; padding: 1.125rem 1.25rem; background: #0a0f1e; border: 2px solid #2a3644; border-radius: 12px; color: #ffffff; font-size: 1rem; font-family: inherit;">
                  <option selected>Economy</option>
                  <option>Premium Economy</option>
                  <option>Business</option>
                  <option>First Class</option>
                </select>
              </div>
            </div>

            <button type="submit"
              style="width: 100%; padding: 1.5rem; background: linear-gradient(135deg, #c5ff68, #a8e050); color: #0a0f1e; border: none; border-radius: 15px; font-size: 1.3rem; font-weight: 800; cursor: pointer; font-family: inherit; transition: all 0.3s;">
              üîç Search Flights
            </button>
          </form>
        </div>

        <!-- Savings Visual -->
        <div style="text-align: center; margin-top: 2rem;">
          <p style="font-size: 1.1rem; color: #8a99b3; margin-bottom: 1.5rem;">See how much you can save:</p>

          <div style="display: inline-flex; align-items: center; gap: 2rem; background: #1e2836; padding: 1.5rem 2.5rem; border-radius: 20px; border: 1px solid #2a3644;">
            <div>
              <div style="font-size: 0.85rem; color: #8a99b3; margin-bottom: 0.25rem;">CREDIT CARD PORTAL</div>
              <div style="font-size: 2rem; font-weight: 800; color: #e74c3c; text-decoration: line-through;">200,000 pts</div>
            </div>
            <div style="font-size: 2rem; color: #4a9cff;">‚Üí</div>
            <div>
              <div style="font-size: 0.85rem; color: #8a99b3; margin-bottom: 0.25rem;">AWARD FLIGHTS</div>
              <div style="font-size: 2rem; font-weight: 800; color: #c5ff68;">55,000 pts</div>
            </div>
            <div style="background: #c5ff68; color: #0a0f1e; padding: 0.75rem 1.25rem; border-radius: 10px; font-weight: 800;">üí∞ Save 72%!</div>
          </div>
        </div>

      </div>
    </section>
  </main>

  <footer class="footer-enhanced">
    <div class="container">
      <div class="footer-bottom">
        <p>&copy; 2026 Award Flights. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="./script.js"></script>
  <script src="./enhancements.js"></script>

  <script>
    let airportsData = [];
    let currentTab = 'roundtrip';

    // Disable nav search (force home first)
    document.getElementById('nav-search')?.addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('home-search')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    // ----------------------------
    // Airports loading + autocomplete
    // ----------------------------
    fetch('https://raw.githubusercontent.com/jpatokal/openflights/master/data/airports.dat')
      .then(r => r.text())
      .then(d => {
        airportsData = d
          .split('\n')
          .filter(l => l)
          .map(l => {
            const p = l.split(',').map(x => x.replace(/"/g, ''));
            return { iata: p[4], city: p[2], name: p[1], country: p[3] };
          })
          .filter(a => a.iata && a.iata.length === 3 && a.iata !== '\\N');

        initAutocomplete();
      })
      .catch(err => console.error('‚ùå Airports load failed:', err));

    function initAutocomplete() {
      document.querySelectorAll('.input-airport').forEach(input => setupAutocompleteSingle(input));
    }

    function normalizeQuery(q) {
      return (q || '').trim();
    }

    function rankAirport(a, qRaw) {
      const q = (qRaw || '').trim().toLowerCase();
      const qUp = q.toUpperCase();

      const iata = (a.iata || '').toUpperCase();
      const city = (a.city || '').toLowerCase();

      // Strong preference: exact IATA match when user typed 3 letters
      if (q.length === 3 && /^[a-z]{3}$/.test(q) && iata === qUp) return 0;

      // Next: IATA startsWith
      if (iata.toLowerCase().startsWith(q)) return 1;

      // Next: IATA contains
      if (iata.toLowerCase().includes(q)) return 2;

      // Next: city startsWith
      if (city.startsWith(q)) return 3;

      // Next: city contains
      if (city.includes(q)) return 4;

      return 9;
    }

    function setupAutocompleteSingle(input) {
      const existing = input.parentElement.querySelector('.airport-dd');
      if (existing) existing.remove();

      const dd = document.createElement('div');
      dd.className = 'airport-dd';
      dd.style.cssText =
        'position:absolute; top:calc(100% + 0.5rem); left:0; right:0; background:#1e2836; border:2px solid #c5ff68; border-radius:12px; z-index:9999; display:none; box-shadow:0 10px 40px rgba(0,0,0,0.7)';

      input.parentElement.style.position = 'relative';
      input.parentElement.appendChild(dd);

      input.addEventListener('input', function () {
        const qRaw = normalizeQuery(this.value);
        const q = qRaw.toLowerCase();

        if (q.length < 1) {
          dd.style.display = 'none';
          return;
        }

        const matches = airportsData
          .filter(a => {
            const i = (a.iata || '').toLowerCase();
            const c = (a.city || '').toLowerCase();
            return i.includes(q) || c.includes(q);
          })
          .sort((a, b) => rankAirport(a, qRaw) - rankAirport(b, qRaw))
          .slice(0, 10);

        if (!matches.length) {
          dd.style.display = 'none';
          return;
        }

        dd.innerHTML = matches.map(a => `
          <div
            style="padding:1rem 1.25rem; cursor:pointer; border-bottom:1px solid #2a3644"
            onmouseover="this.style.background='#0a0f1e'"
            onmouseout="this.style.background='transparent'"
            data-value="${a.iata} - ${a.city}"
          >
            <div style="font-weight:800; color:#c5ff68">${a.iata} - ${a.city}</div>
            <div style="font-size:0.85rem; color:#8a99b3">${a.name}, ${a.country}</div>
          </div>
        `).join('');

        dd.style.display = 'block';

        dd.querySelectorAll('[data-value]').forEach(item => {
          item.addEventListener('click', () => {
            input.value = item.getAttribute('data-value');
            dd.style.display = 'none';
          });
        });
      });

      input.addEventListener('blur', () => setTimeout(() => (dd.style.display = 'none'), 180));

      // If user typed "ORD" and hits Enter elsewhere, keep it (no forced dropdown)
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          const v = (input.value || '').trim().toUpperCase();
          if (/^[A-Z]{3}$/.test(v)) {
            input.value = v;
            dd.style.display = 'none';
          }
        }
      });
    }

    // ----------------------------
    // Tab switching
    // ----------------------------
    function switchTab(tabType) {
      currentTab = tabType;

      document.querySelectorAll('.tab-btn').forEach(t => {
        t.style.color = '#8a99b3';
        t.style.borderBottom = '3px solid transparent';
      });

      const active = document.querySelector('[data-tab="' + tabType + '"]');
      if (active) {
        active.style.color = '#c5ff68';
        active.style.borderBottom = '3px solid #c5ff68';
      }

      if (tabType === 'multicity') {
        showMultiCityDisabled();
      } else if (tabType === 'oneway') {
        showOneWayForm();
      } else {
        showRoundTripForm();
      }
    }

    function showMultiCityDisabled() {
      document.getElementById('search-form').innerHTML = `
        <div style="padding:1.25rem; border:1px solid rgba(74,156,255,0.35); background:rgba(74,156,255,0.10); border-radius:14px; color:#d7e7ff; font-weight:700; margin-bottom:1rem;">
          Multi-city search is not supported yet. Please use One Way or Round Trip.
        </div>

        <button type="button" onclick="switchTab('oneway')"
          style="width:100%; padding:1.25rem; background:#2a3644; color:#fff; border:none; border-radius:15px; font-size:1.1rem; font-weight:800; cursor:pointer; font-family:inherit;">
          Switch to One Way
        </button>
      `;
    }

    function showRoundTripForm() {
      document.getElementById('search-form').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; margin-bottom: 1.5rem; align-items: end;">
          <div style="position: relative;">
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Leaving from</label>
            <input type="text" id="input-from" placeholder="JFK - New York" class="input-airport"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;"
              autocomplete="off" inputmode="search" />
          </div>

          <button type="button" onclick="swapAirports()"
            style="width:48px; height:48px; background:#2a3644; border:none; border-radius:50%; color:#c5ff68; font-size:1.3rem; cursor:pointer;">‚áÑ</button>

          <div style="position: relative;">
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Going to</label>
            <input type="text" id="input-to" placeholder="MXP - Milan" class="input-airport"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;"
              autocomplete="off" inputmode="search" />
          </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:1rem; margin-bottom:2rem;">
          <div>
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Departure</label>
            <input type="date" id="departure-date" required
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit; color-scheme:dark;">
          </div>

          <div id="return-field">
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Return</label>
            <input type="date" id="return-date" required
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit; color-scheme:dark;">
          </div>

          <div>
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Travelers</label>
            <select id="passengers"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;">
              <option selected>1 traveler</option>
              <option>2 travelers</option>
              <option>3 travelers</option>
              <option>4 travelers</option>
            </select>
          </div>

          <div>
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Cabin class</label>
            <select id="cabin"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;">
              <option selected>Economy</option>
              <option>Premium Economy</option>
              <option>Business</option>
              <option>First Class</option>
            </select>
          </div>
        </div>

        <button type="submit"
          style="width:100%; padding:1.5rem; background:linear-gradient(135deg,#c5ff68,#a8e050); color:#0a0f1e; border:none; border-radius:15px; font-size:1.3rem; font-weight:800; cursor:pointer; font-family:inherit;">
          üîç Search Flights
        </button>
      `;

      setTimeout(() => initAutocomplete(), 50);
    }

    function showOneWayForm() {
      document.getElementById('search-form').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; margin-bottom: 1.5rem; align-items: end;">
          <div style="position: relative;">
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Leaving from</label>
            <input type="text" id="input-from" placeholder="JFK - New York" class="input-airport"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;"
              autocomplete="off" inputmode="search" />
          </div>

          <button type="button" onclick="swapAirports()"
            style="width:48px; height:48px; background:#2a3644; border:none; border-radius:50%; color:#c5ff68; font-size:1.3rem; cursor:pointer;">‚áÑ</button>

          <div style="position: relative;">
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Going to</label>
            <input type="text" id="input-to" placeholder="MXP - Milan" class="input-airport"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;"
              autocomplete="off" inputmode="search" />
          </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:1rem; margin-bottom:2rem;">
          <div>
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Departure</label>
            <input type="date" id="departure-date" required
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit; color-scheme:dark;">
          </div>

          <div>
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Travelers</label>
            <select id="passengers"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;">
              <option selected>1 traveler</option>
              <option>2 travelers</option>
              <option>3 travelers</option>
              <option>4 travelers</option>
            </select>
          </div>

          <div>
            <label style="display:block; font-size:0.9rem; color:#8a99b3; margin-bottom:0.5rem; font-weight:600;">Cabin class</label>
            <select id="cabin"
              style="width:100%; padding:1.125rem 1.25rem; background:#0a0f1e; border:2px solid #2a3644; border-radius:12px; color:#ffffff; font-size:1rem; font-family:inherit;">
              <option selected>Economy</option>
              <option>Premium Economy</option>
              <option>Business</option>
              <option>First Class</option>
            </select>
          </div>
        </div>

        <button type="submit"
          style="width:100%; padding:1.5rem; background:linear-gradient(135deg,#c5ff68,#a8e050); color:#0a0f1e; border:none; border-radius:15px; font-size:1.3rem; font-weight:800; cursor:pointer; font-family:inherit;">
          üîç Search Flights
        </button>
      `;

      setTimeout(() => initAutocomplete(), 50);
    }

    // ----------------------------
    // Swap
    // ----------------------------
    function swapAirports() {
      const from = document.getElementById('input-from');
      const to = document.getElementById('input-to');
      if (from && to) {
        const temp = from.value;
        from.value = to.value;
        to.value = temp;
      }
    }

    // ----------------------------
    // Submit handler: REQUIRE DATE
    // ----------------------------
    function getIataFromInput(value) {
      const v = (value || '').trim();
      if (!v) return '';
      const maybe = v.split(' - ')[0].trim().toUpperCase();
      if (/^[A-Z]{3}$/.test(maybe)) return maybe;
      if (/^[A-Z]{3}$/.test(v.toUpperCase())) return v.toUpperCase();
      return '';
    }

    function getAdultsFromSelectText(text) {
      const t = (text || '').toLowerCase();
      if (t.includes('1')) return 1;
      if (t.includes('2')) return 2;
      if (t.includes('3')) return 3;
      if (t.includes('4')) return 4;
      return 1;
    }

    function normalizeCabin(label) {
      const v = (label || '').toLowerCase();
      if (v.includes('first')) return 'FIRST';
      if (v.includes('business')) return 'BUSINESS';
      if (v.includes('premium')) return 'PREMIUM_ECONOMY';
      return 'ECONOMY';
    }

    function showError(msg, focusEl) {
      const box = document.getElementById('form-error');
      box.textContent = msg;
      box.style.display = 'block';
      if (focusEl) {
        focusEl.classList.add('field-error');
        focusEl.focus({ preventScroll: true });
        focusEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    function clearErrors() {
      const box = document.getElementById('form-error');
      box.style.display = 'none';
      box.textContent = '';
      document.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));
    }

    document.addEventListener('submit', (e) => {
      const form = e.target;
      if (!form || form.id !== 'search-form') return;

      e.preventDefault();
      clearErrors();

      if (currentTab === 'multicity') {
        showError('Multi-city search is not supported yet. Please use One Way or Round Trip.');
        return;
      }

      const from = getIataFromInput(document.querySelector('#input-from')?.value);
      const to = getIataFromInput(document.querySelector('#input-to')?.value);

      if (!from) return showError('Please select a valid ‚ÄúLeaving from‚Äù airport (3-letter IATA code).', document.querySelector('#input-from'));
      if (!to) return showError('Please select a valid ‚ÄúGoing to‚Äù airport (3-letter IATA code).', document.querySelector('#input-to'));
      if (from === to) return showError('‚ÄúLeaving from‚Äù and ‚ÄúGoing to‚Äù cannot be the same.', document.querySelector('#input-to'));

      const depEl = document.querySelector('#departure-date');
      const date = depEl?.value || '';
      if (!date) return showError('Please select a departure date.', depEl);

      // For round trip, require return date
      if (currentTab === 'roundtrip') {
        const retEl = document.querySelector('#return-date');
        const ret = retEl?.value || '';
        if (!ret) return showError('Please select a return date (or switch to One Way).', retEl);
        if (ret < date) return showError('Return date cannot be before departure date.', retEl);
      }

      const paxText = document.querySelector('#passengers')?.value || '1 traveler';
      const adults = getAdultsFromSelectText(paxText);

      const cabinText = document.querySelector('#cabin')?.value || 'Economy';
      const cabin = normalizeCabin(cabinText);

      const url = new URL('search.html', window.location.origin);
      url.searchParams.set('from', from);
      url.searchParams.set('to', to);
      url.searchParams.set('date', date);
      url.searchParams.set('adults', String(adults));
      url.searchParams.set('cabin', cabin);

      // mark that user came from home valid search
      url.searchParams.set('src', 'home');

      window.location.href = url.toString();
    });

    // Expose for inline onclick
    window.switchTab = switchTab;
    window.swapAirports = swapAirports;
  </script>
</body>
</html>
